<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Encrypted Master Password (Zen-Cart v1.5.0 to v1.5.5)</title>

<style type="text/css">
<!--
a, a:active, a:visited { color: #006666; text-decoration: none; }
a:hover { color: #00CC99; text-decoration: underline; }
BODY, P, H1, H2, H3, H4, H5, H6, LI, TD, DD, DT, table {   font-family: Verdana, AvantGarde, Tahoma, Arial, sans-serif; font-size: 10pt; color: black; padding: 0px; margin: 20px; }
H1, H2, H3, H4 { font-weight: bold; padding-top: 10px; }
h1 { font-size: 20px; }
h2 { font-size: 16px; background-color: #bcbcbc; padding: 10px; }
h3 { font-size: 14px; background-color: #dcdcdc; padding: 5px; }
h4 { font-size: 12px; border-top: 1px solid #ababab; }
dt { font-weight: bold; margin-bottom: 0; }
dd { margin-top: 0; padding-left: 40px; }
img { margin: 0 20px; }
ol li { margin-left: 0; }
.corefile { color: red; }
.removed { text-decoration: line-through; }
.added { color: blue; }
.changed { color: green; }
.minspacing li { margin: 0; }
ol li, ul li { margin-top: 5px; margin-bottom: 5px; }
ul li ul { padding-left: 0; }
table { border-collapse: collapse; }
td { vertical-align: top; padding: 5px; border-top: 1px solid #404040; }
td.version { vertical-align: middle; font-weight: bold; font-size: larger; }
td.none { font-weight: bold; text-align: center; padding-top: 10px; }
.odd { background-color: #ebebeb; }
.osh { color: darkcyan; }
.smaller { font-size: smaller; }
-->
</style>
</head>

<body>
<a name="top" id="top"></a>
<h1>Encrypted Master Password for Zen Cart v1.5.0 to v1.5.5</h1>
<h3>Version 2.1.1 by lat9</h3>
<p>Current Support Thread at Zen Cart Forums: <a href="www.zen-cart.com/showthread.php?179888-Encrypted-Master-Password-support">www.zen-cart.com/showthread.php?179888-Encrypted-Master-Password-support</a></p>
<h3>Usage Notes</h3>
<ol>
  <li>Version 1.8.0 (and later) of this plugin includes the "Common Orders-Status Update Interface", available <a href="http://www.zen-cart.com/downloads.php?do=file&id=1839" target="_blank">here</a>.  Please make sure that you've subscribed to the current support forum for <em>Encrypted Master Password</em>; I'll post there if there's an interface update required.</a>
</ol>

<hr />
<h2>What it does</h2>
<p><em>Encrypted Master Password</em> (EMP) allows one or more of your store's administrators to login to any customer account using <em>their</em> administrator password in conjunction with a customer's email address.</p>
<h3>Configuration-&gt;My Store</h3>
<p>Once you have have installed the plugin, two configuration values are available in your admin's <em>Configuration-&gt;My Store</em> to provide customization as described below.</p>
<p><strong>Encrypted Master Password: Single Admin ID</strong>. If you want a single admin user to have EMP privileges, you'll set this value to the <em>admin_id</em> of that admin user.  The default (1) selects the first admin user in your store. To find the <em>admin_id</em> value that you want to use, log into your store's admin and click <em>Admin Access Management-&gt;Admin Users</em>.  The left-hand column will be titled <strong>ID</strong>, look for the number that identifies the admin account you've selected.</p>
<p><strong>Encrypted Master Password: Admin Profile ID</strong>. If you want multiple admin users to have EMP privileges, they must be associated with one of the admin <em>User Profiles</em> that you select.  Set this value to a packed, comma-separated list of profile ids (e.g. <b>1,2,3</b>) and all admins in the specified profiles will have EMP authority.  The default value (1) selects all <em>Superuser</em> admins for your store. To find the <em>profile_id</em> values that you want to use, log into your store's admin and click <em>Admin Access Management-&gt;Admin Profiles</em>.  The left-hand column will be titled <strong>ID</strong>, look for the numbers that are associated with the admin user profiles want to configure.</p>
<p>The two configuration values can be used in combination, so that you can specify:</p>
<ul>
  <li><em>One single admin that has EMP privileges:</em> Single Admin ID set to a non-zero <em>admin_id</em>, Admin Profile ID set to 0.</li>
  <li><em>Only admins in the given profiles have EMP privileges:</em> Single Admin ID set to 0, Admin Profile ID set to a non-zero <em>profile_id</em>.</li>
  <li><em>All admins in the given profiles and one admin outside those profiles have EMP privileges:</em> Single Admin ID set to a non-zero <em>admin_id</em>, Admin Profile ID set to a non-zero <em>profile_id</em>.</li>
  <li><em>No admins have EMP privileges:</em> Single Admin ID set to 0, Admin Profile ID set to 0.</li>
</ul>
<h3>Customers-&gt;Customers</h3>
<p>When an admin with EMP permissions views the <em>Customers-&gt;Customers</em> screen, there is an additional button available for the currently-selected customer: <strong>Place Order</strong>. Clicking that button will open a new window, taking the admin to your store's <em>login</em> page.  From that page, the admin enters his/her Zen Cart admin password to log into the customer's account!</p>
<p><strong>Note</strong> Versions 1.6.0 through 1.8.0 of this plugin provided an &quot;automatic&quot; login to the customer's account; version 2.0.0 changed this behavior, now requiring the admin-level password to log into the customer's account.  This change was made to enable the use of the additional password validation methods introduced in Zen Cart v1.5.3 and in light of potential PCI concerns.  With the previous behavior, if someone broke into your Zen Cart admin they would have &quot;the keys to the kingdom&quot; &mdash; access to all your customers' accounts.</p>
<h3>In Your Store</h3>
<p>When an EMP admin logs into a customer account, two session variables are set to identify this condition for future, additional plugins:</p>
<ol>
  <li>$_SESSION['emp_admin_login'] is set to <em>true</em>.</li>
  <li>$_SESSION['emp_admin_id'] is set to the <em>admin_id</em> of the currently signed-in admin</li>
</ol>
<p>In addition, an entry is written to the <b>admin_activity_log</b> to record the event.  If an order is placed by the <em>EMP</em> admin on the customer's behalf, the <b>updated_by</b> field in the order's status history is set to identify the admin that placed the order.</p>
<p>Starting with v2.1.0 of this plugin, a signed-in EMP admin can also change the customer's password on their behalf.</p>
<ul>
  <li>For v2.1.0, the admin navigates to the <code>account_password</code> page, enters <em>their admin password</em> as the current password and the customer's new password in the other two fields.  Upon successful change, an <b>admin_activity_log</b> record is written to record that event.</li>
  <li>For v2.1.1, the Zen Cart v1.5.5 base provides this functionality.  Navigate to your admin's <em>Customers-&gt;Customers</em> and you'll see a <strong>Reset PW</strong> button for the currently-selected customer, which you can use to change that customer's password directly from your admin-console.
</ul>

<hr />
<h2>Installing and Upgrading</h2>
<p>There are <span class="corefile">core-file overwrites</span> in this plugin; you should <strong>always</strong> backup your cart&rsquo;s database and files prior to making any changes.  The files identified using <span class="osh">this</span> color are part of the "Common Orders-Status Update" interface and are subject to separate change!</p>
<ol>
  <li><strong>If you are currently running Zen Cart v1.5.0 through v1.5.2:</strong><ol type="a">
    <li>Copy the plugin's /before_zc153/includes/classes/class.base.php (<span class="corefile">a core file</span>) to your Zen Cart's /includes/classes/class.base.php.</li>
    <li>Compare the <span class="corefile">/before_zc153/includes/modules/pages/login/header_php.php</span> file included with this plugin with the one currently being used at your store. This plugin's version of that file is <em>slightly modified</em> from that shipped with Zen Cart v1.5.3, providing conditional checking of functions introduced in v1.5.3 for previous Zen Cart versions.  If you have made modifications to your current copy of this file, merge those modifications; otherwise, you'll use the version of the file from this plugin.</li>
  </ol></li>
  <li><strong>If you are upgrading from <em>Encrypted Master Password</em> v2.1.0:</strong><ol type="a">
    <li>The ability to change a customer's password from <em>the customer's account</em>, introduced in <em>EMP</em> v2.1.0, has been replaced by a similar feature introduced in Zen Cart v1.5.5 admin's <em>Customers-&gt;Customers</em> handling.  That functionality, included in <em>EMP</em> v2.1.1 and later, enables a Zen Cart admin to change a customer's password using that admin-level page.</li>
    <li>As such, this plugin's change to /includes/modules/pages/account_password/header_php.php <em>is no longer required (or wanted)</em>.  When you upgrade from <em>EMP</em> v2.1.0, you'll need to back-out the changes introduced to that file &mdash; most likely a simple replacement of your current Zen Cart's version of that <span class="corefile">core-file</span>.</li>
  </ol></li>
  <li>Compare the plugin's <strong>/YOUR_ADMIN/customers.php</strong> with the one currently being used at your store.  This plugin's changes (1 block) are surrounded by comments that contain the string <em>EMP login link</em>.  If you have made modifications to your current copy of this file, simply copy the block of changes to your previously-modified copy; otherwise, you'll use the version of the file from this plugin.</li>
  <li>Compare the plugin's <strong>/YOUR_ADMIN/orders.php</strong> with the one currently being used at your store.  This plugin's changes (4 blocks) are surrounded by comments that contain the string <em>osh_updated_by</em> and primarily comment-out processing that is now performed by /includes/functions/extra_functions/osh_updated_by_functions.php.</li>
  <li>Rename /YOUR_ADMIN to match the name of your Zen Cart admin directory.</li>
  <li>Upload the plugin's files to your store's file system:<ol class="minspacing" type="a">
    <li><span class="corefile">/YOUR_ADMIN/customers.php</span></li>
    <li><span class="corefile">/YOUR_ADMIN/orders.php</span><span class="osh">, part of the "Common Orders-Status Update" interface</span></li>
    <li>/YOUR_ADMIN/includes/auto_loaders/config.zc154_compatibility.php</li>
    <li>/YOUR_ADMIN/includes/functions/extra_functions/init_emp_configuration.php</li>
    <li><span class="osh">/YOUR_ADMIN/includes/functions/extra_functions/osh_updated_by_admin_functions.php</span></li>
    <li>/YOUR_ADMIN/includes/init_includes/init_zc154_compatibility.php</li>
    <li><span class="corefile">/YOUR_ADMIN/includes/languages/english/customers.php</span> <span class="smaller">(Added in v2.1.1, this is the Zen Cart v1.5.5 version of the file)</span></li>
    <li>/YOUR_ADMIN/includes/languages/english/extra_definitions/emp_button_definitions.php</li>
    <li><span class="osh">/YOUR_ADMIN/includes/languages/english/osh_updated_by.php</span></li>
    <li>/YOUR_ADMIN/includes/languages/english/images/buttons/button_placeorder.gif</li>
    <li>/includes/auto_loaders/config.emp_login_link.php</li>
    <li>/includes/classes/observers/class.emp_order_observer.php</li>
    <li><span class="removed">/includes/init_includes/init_emp_login_link.php</span>.  Removed in v2.0.0 of this plugin.</li>
    <li><span class="osh">/includes/functions/extra_functions/osh_updated_by_functions.php</span></li>
    <li><span class="removed"><span class="corefile">/includes/modules/pages/account_password/header_php.php</span> <span class="smaller">(Added in v2.1.0)</span></span> <span class="smaller">(Removed in v2.1.1)</span></li>
  </ol></li>
  <li>Sign into your admin-console or, if you are already signed in, click the <em>Admin Home</em> link at the top of the page.  Navigate to <em>Configuration-&gt;My Store</em> and you'll see the two new configuration values for the EMP plugin.</li>
</ol>

<hr />
<h2>Un-install</h2>
<p>Replace the <span class="corefile">core files</span> that were previously overwritten with the backup version that you created. You <strong>did</strong> make a backup, didn't you? Delete the other files copied during the installation. Finally, run the <strong>emp_uninstall.sql</strong> to remove the configuration keys from your database.</p>

<hr />
<h2>Version History:</h2>
<ul>
  <li>v1.0.0, 2006-07-04 (Dennis Sayer, aka stagebrace):<ul>
    <li>Initial release; sponsored by <a href="www.brandnamebatteries.com" target="_blank">Brand Name Batteries for Less</a>.</li>
  </ul></li>
  <li>v1.1.0, 2007-01-16 (Dennis Sayer):<ul>
    <li>Added new code that appeared with Zen Cart 1.3.7.</li>
    <li>A few wording changes in this document.</li>
  </ul></li>
  <li>v1.2.0, 2007-12-01 (Dennis Sayer):<ul>
    <li>Added new code that appeared with Zen Cart 1.3.8.</li>
  </ul></li>
  <li>v1.5.0, 2012-01-19 (dbltoe):<ul>
    <li>Added EMP code to the header_php.php as modified in the new Zen Cart 1.5.0.</li>
    <li>Modified this file to reflect the current information.</li>
  </ul></li>
  <li>v1.5.1, 2013-04-30 (lat9):<ul>
    <li>Updated EMP code to use a define (in preparation for moving it to a configuration setting) for a single admin ID.</li>
    <li>Added code to allow all admins in a specified admin_profile group to perform the EMP function.</li>
    <li>When an EMP admin signs into a customer account, set session variables indicating the type of login and the admin_id of the EMP admin.</li>
    <li>Modified this readme to reflect the current implementation.</li>
  </ul></li>
  <li>v1.5.2, 2013-05-16 (lat9):<ul>
    <li>BUGFIX: White-screen-of-death due to unclosed parentheses.</li>
  </ul></li>
  <li>v1.6.0, 2013-07-08 (lat9):<ul>
    <li>Added SQL statements to move the two configuration values for the plugin into the database.</li>
    <li>Added "Place Order" button in your admin's <em>Customers-&gt;Customers</em> to allow an enabled EMP admin to automatically log into a customer's account.</li>
  </ul></li>
  <li>v1.7.0, 2013-09-08 (lat9):<ul>
    <li>Added an <em>updated_by</em> column to the <em>orders_status_history</em> table.</li>
    <li>When an order is placed by an EMP admin, that admin's ID and name will appear in the <b>updated_by</b> field of the initial <b>orders_status_history</b> record for the order.</li>
    <li>When an EMP admin logs into a customer account, a record is created in the <b>admin_activity_log</b> database table.</li>
  </ul></li>
  <li>v1.8.0, 2013-11-29 (lat9):<ul>
    <li>Incorporate downwardly-compatible changes introduced in Zen Cart v1.5.2.</li>
    <li>Update the "Common Orders-Status Update Interface" to v1.1.0.</li> 
  </ul></li>
  <li>v1.9.0, 2014-04-12 (lat9):<ul>
    <li>Updates to support multiple EMP admin profiles.<ol>
      <li>The initialization .sql script is now imbedded in a PHP script (/YOUR_ADMIN/includes/functions/extra_functions/init_emp_configuration.php).</li>
      <li>A minor update to the <span class="corefile">core-file</span> change to /includes/modules/pages/login/header_php.php.</li>
    </ol></li>
  </ul></li>
  <li>v2.0.0, 2014-07-05 (lat9):<ul>
    <li><em>Conditionally</em> incorporate changes introduced in Zen Cart v1.5.3 to support the improved password handling and to address PCI concerns.  Changed:<ol>
      <li><span class="corefile">/YOUR_ADMIN/customers.php</span></li>
      <li>/includes/auto-loaders/config.emp_login_link.php</li>
      <li><span class="corefile">/includes/classes.class.base.php</span>.  This file is required <em>only</em> for pre-Zen Cart v1.5.3 installations, present in the plugin's <b>/before_zc153</b> folder.</li>
      <li>/includes/classes/observers/class.emp_order_observer.php</li>
      <li><span class="removed">/includes/init_includes/init_emp_login_link.php</span>.  File now contains only comments and can be safely removed from your installation.</li>
      <li><span class="corefile">/includes/modules/pages/login/header_php.php</span>.  This file is required <em>only</em> for pre-Zen Cart v1.5.3 installations, present in the plugin's <b>/before_zc153</b> folder.</li>
    </ol></li>
  </ul></li>
  <li>v2.0.1, 2014-12-20 (lat9):<ul>
    <li>Use Zen Cart v1.5.4 as the core-file overwrite code basis.  Changed/<span class="added">added</span>:<ol>
      <li><span class="corefile">/YOUR_ADMIN/customers.php</span></li>
      <li><span class="corefile">/YOUR_ADMIN/orders.php</span></li>
      <li><span class="added">/YOUR_ADMIN/includes/auto_loaders/config.zc154_compatibility.php</span></li>
      <li><span class="added">/YOUR_ADMIN/includes/init_includes/init_zc154_compatibility.php</span></li>
    </ol></li>
  </ul></li>
  <li>v2.0.2, 2015-05-28 (lat9):<ul>
    <li>Update orders-status-history processing to properly convert CRLF characters in the status-update message.  Changed:<ol>
      <li>/includes/functions/extra_functions/osh_updated_by_functions.php</li>
    </ol></li>
  </ul></li>
  <li>v2.1.0, 2015-09-28 (lat9):<ul>
    <li>Update the plugin's processing, enabling a signed-in EMP admin to change the associated customer's password.</li>
    <li>Change all class constructor function names to __construct (PHP 7 compliance). Changed/<span class="added">added</span>:<ol>
      <li>/includes/classes/observers/class.emp_order_observer.php</li>
      <li><span class="corefile">/includes/modules/pages/account_password/header_php.php</span> <span class="smaller added">(Added)</span></li>
    </ol></li>
  </ul></li>
  <li>v2.1.1, 2015-12-xx (lat9):<ul>
    <li>Use Zen Cart v1.5.5 as the core-file overwrite change-basis.</li>
    <li>The following files were changed/<span class="added">added</span>/<span class="removed">removed</span>:<ol>
      <li><span class="corefile">/before_zc153/includes/modules/pages/login/header_php.php</span></li>
      <li>/includes/classes/observers/class.emp_order_observer.php</li>
      <li><span class="removed"><span class="corefile">/includes/modules/pages/account_password/header_php.php</span></span> <span class="smaller">(Removed from this distribution, <em>only</em>!)</li>
      <li><span class="corefile">/YOUR_ADMIN/customers.php</span></li>
      <li><span class="corefile">/YOUR_ADMIN/orders.php</span></li>
      <li><span class="corefile">/YOUR_ADMIN/includes/languages/english/customers.php</span> <span class="smaller added">(Added)</span></li>
    </ol></li>
  </ul></li>
</ul>
</body>
</html>